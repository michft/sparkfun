#include <avr/io.h>

#include "twi2c.h"

#ifndef F_CPU
#define F_CPU 16000000
#endif
#include <util/delay.h>
#include <stdio.h>
// len, len bytes of transaction, first even = wrinte, odd=read per i2c
// Start, len bytes, rep start, len bytes, 0 does stop
// 20 char

#define LCDADDR 0x7e

unsigned char lcdi0[] = {
    14, 0x7E,0x00,
    0x48,0x64,0xA0,0xC8, 0x44,0x00,0xAB,0x26, 0x81,0x1c,0x56,0x64,
    0};
unsigned char lcdi1[] = {
    4,0x7E,0x00,
    0x2C,0x66,
    0};
unsigned char lcdi2[] = {
    3,0x7E,0x00,
    0x2E,
    0};
unsigned char lcdi3[] = {
    2+7,
    0x7E,0x00,
    0x2F,0xF3,0x00,0x96, 0x38,0x75,0x97,

    2+64,
    0x7E,0x00,
    0x80,0x00,0x81,0x00,0x82,0x00,0x83,0x00,0x84,0x06,0x85,0x06,0x86,0x06,0x87,0x06,
    0x88,0x0B,0x89,0x0B,0x8A,0x0B,0x8B,0x0B,0x8C,0x10,0x8D,0x10,0x8E,0x10,0x8F,0x10,
    0x90,0x15,0x91,0x15,0x92,0x15,0x93,0x15,0x94,0x1A,0x95,0x1A,0x96,0x1A,0x97,0x1A,
    0x98,0x1E,0x99,0x1E,0x9A,0x1E,0x9B,0x1E,0x9C,0x23,0x9D,0x23,0x9E,0x23,0x9F,0x23,
    2+64,
    0x7E,0x00,
    0xA0,0x27,0xA1,0x27,0xA2,0x27,0xA3,0x27,0xA4,0x2B,0xA5,0x2B,0xA6,0x2B,0xA7,0x2B,
    0xA8,0x2F,0xA9,0x2F,0xAA,0x2F,0xAB,0x2F,0xAC,0x32,0xAD,0x32,0xAE,0x32,0xAF,0x32,
    0xB0,0x35,0xB1,0x35,0xB2,0x35,0xB3,0x35,0xB4,0x38,0xB5,0x38,0xB6,0x38,0xB7,0x38,
    0xB8,0x3A,0xB9,0x3A,0xBA,0x3A,0xBB,0x3A,0xBC,0x3C,0xBD,0x3C,0xBE,0x3C,0xBF,0x3C,
    2+3,
    0x7E,0x00,
    0x38,0x74,0xAF,
    0};


unsigned char sendlcda0[] = {
    5, LCDADDR,0,0xb0,0x10,1,
    0,0
};

unsigned char sendlcdb0[] = {
    6, LCDADDR,0,0,0,0,0,
    0,0
};



int main(void)
{
    unsigned char text, page;

    TWIinit();
    _delay_ms(20);
    TWIdocmd(lcdi0);
    _delay_ms(200);
    TWIdocmd(lcdi1);
    _delay_ms(200);
    TWIdocmd(lcdi2);
    _delay_ms(10);
    TWIdocmd(lcdi3);
    for (;;)
        for( page = 0xb0; page < 0xbd; page++) {
            sendlcda0[3] = page;
            TWIdocmd(sendlcda0);
            for( text = 0 ; text < 160; text++ ) {
                sendlcdb0[3] = text;
                sendlcdb0[4] = text;
                sendlcdb0[5] = text;
                sendlcdb0[6] = text;
                TWIdocmd(sendlcdb0);
                _delay_ms(10);
            }
        }
}

